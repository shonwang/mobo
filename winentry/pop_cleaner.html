<!DOCTYPE html>
<html>
<head>
  <title></title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <link href="../common/style/base.css" rel="stylesheet" type="text/css">
  <link href="../common/view/popup/popup.css" rel="stylesheet" type="text/css">
  <link href="../common/view/window/window.css" rel="stylesheet" type="text/css">
  <style>
  		.g-popup.g-window{
  			width:288px;
  			height:388px;
  			box-shadow: 0 0 5px #ccc;
  			border-width: 1px;
  		}
  		.g-window-ctn{
  			padding:0;
  			border:none;
  		}
  		.g-window-body{
  			height:300px;
  			background:#0096E3;
  			position:relative;
  			-webkit-transition: background 0.8s;
  		}
  		.g-window-body img{
  			position:absolute;
  		}
  		.g-clean-title{
  			line-height: 30px;
			height: 32px;
			padding: 0 40px 0 25px;
			font-size: 14px;
			color: #fff;
      background: url(custom/images/clean-logo.png) no-repeat left center;
      margin:0 5px; 
  		}
  		#btn-clean{
  			margin:30px auto 0;
  			display:block;
  		}
  		.animation{
			-webkit-animation-duration:.8s;
			-webkit-animation-timing-function:linear;
		}
		@-webkit-keyframes rotateIn{
			0%{
				-webkit-transform-origin:center center;
				-webkit-transform:rotate(0deg)
			}
			100%{
				-webkit-transform-origin:center center;
				-webkit-transform:rotate(360deg);	
			}
		}
  		.saoba{
			 width:160px;
			 height:160px;
			 display:inline-block;
			 position:relative;
			 background:url(custom/images/clean-bg.png) no-repeat;
			 left:50%;
			 margin-left:-80px;
			 background-size:160px;
		}
		.less{
			padding:18px 5px 0;
			text-align:center;
			color:#fff;
		}
  		.less .size{
  			font-size:16px;
  			padding-bottom:10px;
  		}
  		.less .size b{
  			font-size: 48px;
			font-weight: normal;
  		}
  		.less .text{
  			opacity:0.8;
  		}

      body[language="arabic"] .g-clean-title,body[language="farsi"] .g-clean-title{direction: rtl;padding: 0 25px 0 40px;background-position: right;}
      body[language="arabic"] .g-popup.g-window .ico-close,body[language="farsi"] .g-popup.g-window .ico-close{right: auto;left: 6px}
  </style>
  
</head>
<body>
<div class="g-popup g-window">
    <i class="g-window-header-x ico-close ico-close-gary"></i>
    <!-- Start 内容 -->
    <div class="g-window-ctn">
    	<div class="g-window-body">
    		<img  draggable="false" src="custom/images/clean-body.png" >
    		<div class="g-clean-title">
	             PC Cleaner
	        </div>
	        <div class="resource-activity pc-clean-pop" >
	            <div class="total-statics">
	            	<div class="cleaner-top">
	    				<p class="saoba"></p>
		    			<div class="less">
			    			<p class="size"><b class="num"></b><span class="mb"></span></p>
			    			<P class="text"></P>
			    		</div>
	    			</div>
           		 </div>
        	</div>
       </div>
       <button id="btn-clean" class="btn-clean g-btn g-btn1">Clean</button>
    </div>
    <!-- End 内容 -->
</div>
<script type="text/javascript">
    document.oncontextmenu = function(){return false};
        var dic={
            arabic:{
                staticsInfo:"قد تم  تنظيف {1} ملفات غير مرغوب فيه و {0} نفايات التسجيل",
                cleanLabel:"تنظيف"
            },
            chinese:{
                staticsInfo:"可清理{0}个垃圾文件和{1}项注册表垃圾",
                cleanLabel:"清理"
            },
            english:{
                staticsInfo:"{0} junk files and {1} registry files can be cleaned.",
                cleanLabel:"Clean"                
            },
            farsi:{
                staticsInfo:"می‌توانید {1} فایل بی‌استفاده و {0} فایل رجیستری را پاک کنید.",
                cleanLabel:"پاک کردن"                   
            },
            france:{
                staticsInfo:"{0} fichiers indésirables et {1} fichiers de registre peuvent être nettoyés.",
                cleanLabel:"Nettoyage"
            },
            hindi:{
                staticsInfo:"{0} जंक फ़ाइलें और {1} रजिस्ट्री फ़ाइलें साफ़ की जा सकती हैं.",
                cleanLabel:"साफ़ करें"
            },
            indonesian:{
                staticsInfo:"Berkas sampah {0} dan Berkas Registri {1} bisa dibersihkan.",
                cleanLabel:"Bersihkan"                
            },
            italian:{
                staticsInfo:"È possibile eliminare {0} file indesiderati e {1} file del Registro di sistema.",
                cleanLabel:"Pulisci"                      
            },
            korean:{
                staticsInfo:"{0}개 불필요 파일과 {1}개 레지스트리 파일을 삭제할수 있습니다.",
                cleanLabel:"정리"
            },
            poland:{
                staticsInfo:"Pliki-śmieci {0} i pliki rejestru {1} mogą zostać wyczyszczone.",
                cleanLabel:"Wyczyść"
            },
            portuguese:{
                staticsInfo:"{0} arquivos inúteis a {1} arquivos de registro podem ser limpos.",
                cleanLabel:"Limpar"                
            },
            russian:{
                staticsInfo:"{0} мусорных файлов и {1} файлов регистра возможно очистить",
                cleanLabel:"Очистить"                      
            },
            spanish:{
                staticsInfo:"{0} Archivos basura y archivos de registro {1} se pueden limpiar.",
                cleanLabel:"Limpio"                
            },
            thai:{
                staticsInfo:"{0} ไฟล์ขยะและ {1} ไฟล์รีจิสทรีสามารถทำความสะอาดได้.",
                cleanLabel:"ทำความสะอาด"                      
            },
            traditionalchinese:{
                staticsInfo:"可清理 {0}個垃圾檔和 {1}項登錄碼垃圾！",
                cleanLabel:"清理"
            },
            vietna:{
                staticsInfo:"Có thể dọn dẹp {0} tệp rác và {1} tệp đăng ký.",
                cleanLabel:"Dọn dẹp"
            },
            turkish:{
                staticsInfo:"{0} atık dosyalar ve {1} kayıt dosyaları temizlenebilir",
                cleanLabel:"Temizle"
            }
        };
        //*********************************************************
	    //20140928 新版日志
      function sendMessageCallback(action, paras, callback){
          app.setMessageCallback(action, function(bn, args) {
                var res;
                try{
                    res = JSON.parse(args[0]);
                }catch(e){
                    res = args[0];
                }
                callback && callback(res);
                app.removeMessageCallback(action);
          });
          //var requestId = new Date().valueOf();
          app.sendMessage(action, [JSON.stringify(paras)]);
      }
	    var isGetPulickFeild = false;
	    var log_channelid = "-";
	    var log_version = "-";
	    var log_sessionid = "-";
	    var log_site = "-";
	    var log_pclg = "-";
	    var log_phonestatus = "-";
	    var log_service_id = "1000120";
	    var newLog = {
	        class: "c20002",
	        page: "p20002",
	        module: "m20003"
	    }
		var showLog = {
	        class: "c20002",
	        page: "p20002",
	        module: "m20003"
	    }
	    var logS2 = {
	        module: "notification",
	        targetvalue: "clean1",
	        status: 1,
	        httpcode: 200
	    }
	    sendMessageCallback("get_GetClientInfo", {}, function(res){
	        console.log("新版日志公共字段：", Object.keys(res.info).length);
	        if (res&&res.info){
	            log_channelid = res.info.channelid;
	            log_version = res.info.clientVer;
	            log_sessionid = res.info.sessionid;
	            log_site = res.info.site;
	            log_pclg = res.info.language;
	        }
	    });
	    var sendNewLog = function (logServiceExt){
	    	var log_time = new Date().valueOf();
	        var log_nettype = "-";
	
	        logServiceExt = JSON.stringify(logServiceExt);
	        console.log(logServiceExt)
	         var feildStr = [log_channelid, log_version, log_sessionid, log_time, log_nettype, log_site, log_phonestatus, log_pclg, log_service_id, logServiceExt].join("###");
	        console.log("%c 新版日志 >> " + feildStr, "color:#13abe1");
	         try{
	         	app.sendMessage("get_ReportLog2",  [feildStr]);  
	         }catch (error){}   
	        
	    };
	    
	    
	    //*********************************************************
	    //旧版日志

	    var serializeObj = function(obj){
	        var u = '';
	        for(var key in obj){
	            var kv = key + '=' + obj[key];
	            u = u + kv + '&';
	        }
	        return u.slice(0, u.lastIndexOf('&'));
	    };
	
	    var sendStatistics = function(paras){
	        try {
	            var actionName = paras.action;
	            var agrsStr = paras.args || {};
	            
	            var paramObj = {
	                S1 : actionName||"",
	                S2 : JSON.stringify(agrsStr),
	                sid :"1000130"
	            };
	            console.log("%c utility >> event log info: " + serializeObj(paramObj), "color:green");
	
	            app.sendMessage("get_ReportLog", {
	                paramer: serializeObj(paramObj)
	            });
	        } catch (error){
	            console.error("utility >> event log info: ", error); 
	        }
	    };

	    
	    
	    //*********************************************************
        var getParameter = function(name, targetUrl){
        var url = targetUrl || location.href;  
        
        if(url.indexOf('#') > -1){
            url = url.slice(0, url.indexOf('#'));
        }
        
        var paraString = url.substring(url.indexOf("?") + 1, url.length).split("&");  
        var paraObj = {}  
        for (i = 0; j = paraString[i]; i++) {  
            paraObj[j.substring(0, j.indexOf("=")).toLowerCase()] = j.substring(j.indexOf("=") + 1, j.length);  
        }  
        var returnValue = paraObj[name.toLowerCase()];  
        if (typeof (returnValue) == "undefined") {  
            return "";  
        } else {  
            return window.decodeURIComponent(returnValue);  
        }  
    };
	function convertSizeToString(initSize){
        if(initSize == 0){
            return 0 + "KB";
        }else if(initSize < 1024){
            return initSize + "B";
        }else if((initSize / 1024) < 1024){
            return Math.ceil((initSize / 1024)) + "KB";
        }else if((initSize / (1024*1024)) < 1024){
            return (initSize / (1024*1024)).toFixed(2) + "MB";
        }else if((initSize / (1024*1024*1024)) < 1024){
            return (initSize / (1024*1024*1024)).toFixed(2)+"GB";
        }
    };

    window.onload=function(){
    	/*发送日志开始*/
    	showLog.action = "a20022";
    	showLog.targetvalue = "clean1";
    	if (log_channelid === "-"){  
      	    setTimeout(function(){
              sendNewLog(showLog);
              
            }, 2000);
        } else {
            sendNewLog(showLog);
        }
        
        var log = {
	        action: "pushshowup",
	        args: logS2
	    }
	    sendStatistics(log);
        /*发送日志结束*/
        var a = 0;
	    var cleanBody = document.querySelector(".g-window-body");
	    var time = setInterval( function(){
	    	a++;
	    	if( a == 1){
	    		cleanBody.style.background = "#68B206"
	    	}else if(a == 2){
	    		cleanBody.style.background = "#F2BB15"
	    	}else if(a == 3){
	    		cleanBody.style.background = "#E39000"
	    	}else if(a == 4){
	    		cleanBody.style.background = "#e35000"
	    		clearInterval(time)
	    	}
	    },500)
        var size=getParameter("size",location.href);
        var files=getParameter("fileCount",location.href);
        var regs=getParameter("regCount",location.href);
        var language=getParameter("language",location.href);
        if(language == "arabic" || language == "farsi"){
        document.querySelector("body").setAttribute("language","arabic");
          }else{
              document.querySelector("body").removeAttribute("language");
          }
        console.log("size:"+size+";regs:"+regs+";language:"+language+";files:"+files);
        var tt = convertSizeToString(size).replace(/[^0-9.]/g,'');
        var num = size / 100;
        var ts = convertSizeToString(num).replace(/[^0-9.]/g,''),
	    	tb = convertSizeToString(num).replace(/[0-9.]/g,''); 
	    var s = 0;
	    var timer = setInterval( function(){
	     	s++;
	     	var nums = num * s;
	     	var ts = convertSizeToString(nums).replace(/[^0-9.]/g,''),
	    		tb = convertSizeToString(nums).replace(/[0-9.]/g,''); 
	    	
	    	document.querySelector(".total-statics .less .num").innerHTML=ts;
        	document.querySelector(".total-statics .less .mb").innerHTML=tb;
	    	if( s == 100){
	    		clearInterval(timer)
	    	}
	     },20);
        document.getElementById("btn-clean").innerHTML = dic[language].cleanLabel;
        document.querySelector(".total-statics .text").innerHTML=dic[language||"english"]["staticsInfo"].replace("{0}",files).replace("{1}",regs);
        document.querySelector(".g-window-header-x.ico-close").onmousedown = function(){
	        app.sendMessage("get_DragMainDisabled");
	    };

        document.querySelector(".g-window-header-x.ico-close").addEventListener("click",function(){
           app.sendMessage("get_Close", []);
        });
        document.getElementById("btn-clean").addEventListener("click",function(){
        	console.log("开始清理");   
             //发送日志开始
		    newLog.action = "a20023";
		    newLog.targetvalue = "clean1";
		    newLog.targettype = "16";
		    sendNewLog(newLog); 
		    
		    logS2.targettype = "16";
			var log = {
		        action: "pushclick",
		        args: logS2
		    }
		    sendStatistics(log);
		    //发送日志结束
            app.sendMessage("get_ShowWindow", [JSON.stringify({cmdShow: 1})],function(){
                console.log("消息已经发出");
            });
            app.sendMessage("get_NotifyMainWindow",  [JSON.stringify({
                action: "pcClean"
            })],function(){
                console.log("消息已经发出");
            });
            app.sendMessage("get_Close", []);
        });
    }
</script>
</body>
</html>